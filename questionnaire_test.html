<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Feuilles de style et scripts existants ici -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <title>Questionnaire de Navigation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            max-width: 600px;
            margin: auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2a9d8f;
            text-align: center;
            font-size: 1.8em;
        }

        label {
            display: block;
            margin-top: 20px;
            font-weight: bold;
            color: #264653;
        }

        select, input[type="date"], input[type="range"], button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 1em;
            outline: none;
        }

        /* Style de la barre glissante avec dégradé uniquement pour #difficulty */
        #difficulty {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 35px;
            border-radius: 5px;
            background: linear-gradient(to right, rgb(247, 247, 248) 0%,rgb(68, 0, 255) 100%);
            position: relative;
        }

        #difficulty::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 35px;
            height: 35px;
            background-color: #2a9d8f;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Style classique pour toutes les autres barres */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 35px;
            border-radius: 5px;
            background-color: #ddd; /* Couleur de fond grise classique */
            position: relative;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 35px;
            height: 35px;
            background-color: #2a9d8f;
            border-radius: 50%;
            cursor: pointer;
        }

        .range-container {
            position: relative;
            margin-top: 15px;
        }

        .range-values {
            font-size: 1em; /* Augmenter la taille de la police */
            color: #333; /* Couleur plus foncée */
            font-weight: bold; /* Texte en gras */
            margin-bottom: 5px; /* Ajuster l'espacement */
            text-align: center;
            background-color: #e9ecef; /* Arrière-plan gris clair */
            padding: 5px; /* Ajouter du padding */
            border-radius: 5px; /* Coins arrondis */
            border: 1px solid #ccc; /* Ajouter une bordure */
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: #999;
            margin-top: 5px;
            margin-bottom: 10px;
            padding: 0 5px;
        }

        .checkbox-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-container label {
            background-color: #e9ecef;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-container input[type="checkbox"] {
            display: none;
        }

        .checkbox-container input[type="checkbox"]:checked + label {
            background-color: #2a9d8f;
            color: #fff;
        }

        button {
            background-color: #2a9d8f;
            color: #fff;
            font-size: 1.2em;
            border: none;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #23827d;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.5em;
            }

            label {
                font-size: 1em;
            }

            button {
                font-size: 1em;
            }

            .range-labels {
                font-size: 0.7em;
            }
        }

        #suggestions div {
            padding: 10px;
            cursor: pointer;
        }

        #suggestions div:hover {
            background-color: #f0f0f0;
        }

        #difficulty-value {
            font-size: 1.2em;
            color: rgb(56, 52, 52);
            background-color: #f8fafa;
            padding: 5px 10px;
            border-radius: 10px;
            display: inline-block;
        }


    </style>
</head>
<body>

<form id="myForm">

    <h1>Questionnaire de Navigation</h1>

    <label for="date">Choisissez une date :</label>
    <input type="date" id="date" name="date" required>

    <label for="city-search">Rechercher une ville :</label>
    <input type="text" id="city-search" name="city-search" placeholder="Tapez le nom d'une ville..." required>
    <div id="suggestions" style="border: 1px solid #ccc; display: none; margin-top: -1px; z-index: 1000; background: #fff; position: absolute; width: 100%; max-height: 150px; overflow-y: auto;"></div>
    <input type="hidden" id="latitude" name="latitude">
    <input type="hidden" id="longitude" name="longitude">

    <label for="map">Choisissez une ville en cliquant sur la carte :</label>
    <div id="map" style="width: 100%; height: 400px; margin-top: 10px;"></div>

    <label for="duration">Durée de l'entraînement (en minutes) :</label>
    <div class="range-values" id="duration-value">60 minutes</div> <!-- Indicateur déplacé au-dessus -->
    <input type="range" id="duration" name="duration" min="10" max="240" step="5" value="60" oninput="updateDuration()">
    <div class="range-labels">
        <span>10</span><span>80</span><span>160</span><span>240</span>
    </div>

    <label>Type d'entraînement :</label>
    <div class="checkbox-container">
        <input type="checkbox" name="nav-mode" value="Slalom" id="slalom">
        <label for="slalom">Slalom</label>
        <input type="checkbox" name="nav-mode" value="Course Race" id="course-race">
        <label for="course-race">Course Race</label>
        <input type="checkbox" name="nav-mode" value="Longue Distance" id="longue-distance">
        <label for="longue-distance">Longue Distance</label>
        <input type="checkbox" name="nav-mode" value="Test Matériel" id="test-materiel">
        <label for="test-materiel">Test Matériel</label>
        <input type="checkbox" name="nav-mode" value="PMA" id="pma">
        <label for="pma">PMA</label>
        <input type="checkbox" name="nav-mode" value="Nav Technique Manoeuvres" id="nav-technique-manoeuvres">
        <label for="nav-technique-manoeuvres">Nav Technique Manoeuvres</label>
        <input type="checkbox" name="nav-mode" value="Nav Technique Speed Test" id="nav-technique-speed-test">
        <label for="nav-technique-speed-test">Nav Technique Speed Test</label>
    </div>

    <label for="difficulty">Niveau de difficulté (1 à 10) :</label>
    <div class="range-values" id="difficulty-value">5</div> <!-- Indicateur déplacé au-dessus -->
    <input type="range" id="difficulty" name="difficulty" min="0" max="10" step="0.5" value="5" oninput="updateDifficulty()">
    <div class="range-labels">
        <span>1</span><span>3</span><span>5</span><span>7</span><span>10</span>
    </div>

    <label for="wind-range">Plage de vent (en noeuds) :</label>
    <div class="range-values" id="wind-values">10 - 20 noeuds</div> <!-- Indicateur déplacé au-dessus -->
    <div class="range-container">
        <input type="range" id="wind-min" name="wind-min" min="0" max="54" value="10" oninput="updateWindRange()">
        <input type="range" id="wind-max" name="wind-max" min="0" max="54" value="20" oninput="updateWindRange()">
    </div>
    <div class="range-labels">
        <span>0</span><span>20</span><span>40</span><span>54</span>
    </div>

    <label for="wind-dir-range">Plage de direction du vent (en degrés) :</label>
    <div class="range-values" id="wind-dir-values">0° (N) - 180° (S)</div> <!-- Indicateur déplacé au-dessus -->
    <div class="range-container">
        <input type="range" id="wind-dir-min" name="wind-dir-min" min="0" max="360" value="0" oninput="updateWindDirRange()">
        <input type="range" id="wind-dir-max" name="wind-dir-max" min="0" max="360" value="180" oninput="updateWindDirRange()">
    </div>
    <div class="range-labels">
        <span>0°</span><span>90°</span><span>180°</span><span>270°</span><span>360°</span>
    </div>

    <button type="submit">Soumettre</button>

</form>

    <script>
        // Initialisation de la carte
        const map = L.map('map').setView([48.8566, 2.3522], 6); // Coordonnées de Paris

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        let marker = L.marker([48.8566, 2.3522]).addTo(map); // Marqueur initial à Paris

        // Recherche de villes
        const citySearchInput = document.getElementById("city-search");
        const suggestionsDiv = document.getElementById("suggestions");

        citySearchInput.addEventListener("input", function () {
            const query = this.value;
            if (query.length < 2) {
                suggestionsDiv.style.display = "none"; // Masquer les suggestions si moins de 2 caractères
                return;
            }

            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}`)
                .then(response => response.json())
                .then(data => {
                    suggestionsDiv.innerHTML = "";
                    if (data.length > 0) {
                        data.forEach(city => {
                            const div = document.createElement("div");
                            div.textContent = city.display_name;
                            div.onclick = function () {
                                citySearchInput.value = city.display_name; // Mettre à jour le champ de texte avec le nom de la ville
                                console.log("Ville sélectionnée:", city.display_name); // Debug pour vérifier la ville
                                document.getElementById("latitude").value = city.lat; // Mettre à jour la latitude
                                document.getElementById("longitude").value = city.lon; // Mettre à jour la longitude
                                marker.setLatLng([city.lat, city.lon]); // Mettre à jour le marqueur
                                map.setView([city.lat, city.lon], 10); // Centrer la carte sur la ville
                                suggestionsDiv.style.display = "none"; // Masquer les suggestions
                            };
                            suggestionsDiv.appendChild(div);
                        });
                        suggestionsDiv.style.display = "block"; // Afficher les suggestions
                    } else {
                        suggestionsDiv.style.display = "none"; // Masquer les suggestions si aucune ville trouvée
                    }
                });
        });


        // Fonction pour mettre à jour la durée
        function updateDuration() {
            const durationValue = document.getElementById("duration-value");
            const duration = document.getElementById("duration").value;
            durationValue.textContent = `${duration} minutes`;
        }

        // Fonction pour mettre à jour la couleur et la valeur de la barre de difficulté
        function updateDifficulty() {
            const difficulty = document.getElementById('difficulty');
            const value = difficulty.value;
            const difficultyValue = document.getElementById('difficulty-value');

            // Afficher la valeur de la difficulté au-dessus de la barre
            difficultyValue.textContent = value;

            // Calculer la position en pourcentage
            const percentage = ((value - difficulty.min) / (difficulty.max - difficulty.min)) * 100;

            // Dégradé dynamique du vert (1) au rouge (10) en fonction de la valeur
            const color = `linear-gradient(to right, green ${percentage}%, #ddd ${percentage}%)`;

            // Appliquer le dégradé à la barre de range
            difficulty.style.background = color;
        }

        // Initialiser la barre au chargement avec la couleur correcte
        window.onload = function() {
            updateDifficulty();
        };

        // Fonction pour mettre à jour la difficulté avec la couleur fluide
        function updateDifficulty() {
            const difficulty = document.getElementById('difficulty');
            const value = difficulty.value;
            const difficultyValue = document.getElementById('difficulty-value');

            // Afficher la valeur de la difficulté au-dessus de la barre
            difficultyValue.textContent = value;


            // Appliquer la couleur de fond au texte de la valeur
            difficultyValue.style.backgroundColor = bgColor;
        }

        // Fonction pour mettre à jour la plage de vent
        function updateWindRange() {
            const windMin = document.getElementById("wind-min").value;
            const windMax = document.getElementById("wind-max").value;
            document.getElementById("wind-values").textContent = `${windMin} - ${windMax} noeuds`;
        }

        function updateWindDirRange() {
            const windDirMin = document.getElementById("wind-dir-min").value;
            const windDirMax = document.getElementById("wind-dir-max").value;

            const windDirMinLetter = degreesToDirection(windDirMin);
            const windDirMaxLetter = degreesToDirection(windDirMax);

            document.getElementById("wind-dir-values").textContent = `${windDirMin}° (${windDirMinLetter}) - ${windDirMax}° (${windDirMaxLetter})`;
        }


        // Fonction pour convertir les degrés en direction du vent (lettres)
        function degreesToDirection(degrees) {
            const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW', 'N'];
            const index = Math.round(degrees / 45) % 8;
            return directions[index];
        }

    </script>

<script>
    document.getElementById("myForm").addEventListener("submit", function (e) {
            e.preventDefault(); // Empêche le rechargement de la page

            const formData = new FormData(this); // Capture les données du formulaire

            // Récupérer les valeurs cochées des types d'entraînements
            const navMode = Array.from(document.querySelectorAll('input[name="nav-mode"]:checked'))
                .map(el => el.value)
                .join(", ");
            formData.append("navMode", navMode); // Ajouter à la liste des données envoyées

            // Ajouter les valeurs de la plage de vent
            const windMin = document.getElementById("wind-min").value;
            const windMax = document.getElementById("wind-max").value;
            formData.append("windMin", windMin); // Plage de vent minimale
            formData.append("windMax", windMax); // Plage de vent maximale

            // Ajouter les valeurs de la plage de direction du vent
            const windDirMin = document.getElementById("wind-dir-min").value;
            const windDirMax = document.getElementById("wind-dir-max").value;
            formData.append("windDirMin", windDirMin); // Direction du vent minimale
            formData.append("windDirMax", windDirMax); // Direction du vent maximale

            // Récupérer le nom de la ville
            const city = document.getElementById("city-search").value;
            formData.append("city-search", city); // Ajouter la ville

            // Envoi des données au script Google Apps Script via une requête POST
            fetch('https://script.google.com/macros/s/AKfycbyeHHTzo1mFDzw_UfhL7sVBKhmQK9CBPZLlzS1wOb9oaoNcyxKEhLoXjIb1nDCtaO1VtQ/exec', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json()) // Analyser la réponse JSON
            .then(data => {
                alert("Données envoyées avec succès !");
            })
            .catch(error => {
                alert("Erreur lors de l'envoi des données.");
                console.error(error);
            });
        });
    </script>


</body>
</html>









